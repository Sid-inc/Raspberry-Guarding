# Raspberry-Guarding
Датчик открытия двери с отправкой сообщения в телеграмм на raspberry pi

Принцип работы:

В крон добавляется задача на запуск каждую минуту скрипта chat_monitoring.sh
Скрипт выполняет 8 раз с интервалом 3 секунды файл telegram_bot.php (частоту запусков и задержку можно изменить в файле chat_monitoring.sh чем чаще мониторится чат тем быстрее бот реагирует на команды)

Скрипт telegram_bot.php для начала проверяет нет ли уже выполняющихся его копий, если есть, сразу завершается, если нет, проверяет чат на наличие новых сообщений. 
Если сообщение есть, смотрим какое именно, если это команда на запуск охраны "guard on", проверяем текущий статус охраны, если она уже запущена, ничего не делаем, если остановлена запускаем скрипт guarding.sh.
Если сообщение "guard off" так же проверяем статус охраны и если она запущена убиваем guarding.sh.

Скрипт guarding.sh в цикле постоянно проверяет состояние GPIO выводов малинки к которым подключен геркон двери.
Если контак замкнут, идет на следующий цикл, если контакт разомкнулся, отправляет сообщение об открытии двери в чат с помощью скрипта messages/door_open.php, если после этого дверь закрылась контакт замкнулся отправляет сообщение о закрытии двери скриптом messages/door_close.php

Файл telegram.php содержит настройки для чата в телеграме, прокси сервера и т.д.

Демонстрация работы: https://youtu.be/25Otk4HG8ak
